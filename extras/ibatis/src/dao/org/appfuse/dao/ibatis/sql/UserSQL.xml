<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
    PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
    "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="UserSQL">

	<insert id="addUser" parameterClass="org.appfuse.model.User">
    <![CDATA[
      INSERT INTO 
      app_user (id, username, password, firstName, lastName, address, city,
                country, email, phoneNumber, postalCode, province, 
                website, passwordHint)
      VALUES (#id#, #username#, #password#, #firstName#, #lastName#, #address#, 
              #city#, #country#, #email#, #phoneNumber#, #postalCode#, 
              #province#, #website#, #passwordHint#);
    ]]>
  </insert>
    
	<select id="getUserId" resultClass="java.lang.Long">
    <![CDATA[
      SELECT max(id) from app_user;
    ]]>
  </select>
    
	<insert id="addUserRole">
    <![CDATA[
      INSERT INTO 
      user_role (id, user_id, username, role_name)
      VALUES (#id#, #userId#, #username#, #roleName#);
    ]]>
  </insert>
    
	<select id="getRoleId" resultClass="java.lang.Long">
    <![CDATA[
      SELECT max(id) from user_role;
    ]]>
  </select>
    
	<update id="updateUser" parameterClass="org.appfuse.model.User">
    <![CDATA[
      UPDATE app_user SET
          username = #username#,
          password = #password#,
          firstName = #firstName#,
          lastName = #lastName#,
          address = #address#,
          city = #city#,
          country = #country#,
          email = #email#,
          phoneNumber = #phoneNumber#,
          postalCode = #postalCode#,
          province = #province#,
          website = #website#,
          passwordHint = #passwordHint#
      WHERE id = #id#;
    ]]>
  </update>
    
	<select id="getUser" resultClass="org.appfuse.model.User">
    <![CDATA[
      SELECT * FROM app_user WHERE username=#username#;
    ]]>
  </select>
    
	<select id="getUsers" resultClass="org.appfuse.model.User">
    <![CDATA[
      SELECT * FROM app_user ORDER BY UPPER(username);
    ]]>
  </select>
    
	<select id="getUserRoles" resultClass="org.appfuse.model.UserRole">
    <![CDATA[
      SELECT id, role_name as roleName, user_id as userId, username
      FROM user_role WHERE username=#username#;
    ]]>
  </select>
    
	<delete id="deleteUser">
    <![CDATA[
      DELETE FROM app_user where username = #username#;
    ]]>
  </delete>
    
	<delete id="deleteUserRoles">
    <![CDATA[
      DELETE FROM user_role WHERE username = #username#;
    ]]>
  </delete>
    
	<select id="getUserCookies" resultClass="org.appfuse.model.UserCookie">
    <![CDATA[
      SELECT id, username, cookie_id as cookieId, date_created as dateCreated
      FROM user_cookie where cookie_id = #cookieId#;
    ]]>
  </select>
    
	<delete id="deleteUserCookies">
    <![CDATA[
      DELETE FROM user_cookie where username = #username#;
    ]]>
    </delete>
    
	<insert id="addUserCookie" parameterClass="org.appfuse.model.UserCookie">
    <![CDATA[
      INSERT INTO 
      user_cookie (id, username, cookie_id, date_created)
      VALUES (#id#, #username#, #cookieId#, #dateCreated#);
    ]]>
  </insert>
    
	<select id="getUserCookieId" resultClass="java.lang.Long">
    <![CDATA[
      SELECT max(id) FROM user_cookie;
    ]]>
  </select>
    
	<update id="updateUserCookie" parameterClass="org.appfuse.model.UserCookie">
    <![CDATA[
      UPDATE user_cookie SET
          username = #username#,
          cookie_id = #cookieId#,
          date_created = #dateCreated#
      WHERE id = #id#;
    ]]>
  </update>
</sqlMap>
