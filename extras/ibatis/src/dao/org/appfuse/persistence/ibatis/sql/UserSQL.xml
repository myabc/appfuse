<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sql-map PUBLIC "-//iBATIS.com//DTD SQL Map 1.0//EN"
    "http://www.ibatis.com/dtd/sql-map.dtd">

<sql-map name="UserSQL">

	<mapped-statement name="addUser" result-class="java.lang.Integer">
    <![CDATA[
      INSERT INTO 
      app_user (id, username, password, firstName, lastName, address, city,
                country, email, phoneNumber, postalCode, province, 
                website, passwordHint)
      VALUES (#id#, #username#, #password#, #firstName#, #lastName#, #address#, 
              #city#, #country#, #email#, #phoneNumber#, #postalCode#, 
              #province#, #website#, #passwordHint#);
    ]]>
    </mapped-statement>
    
	<mapped-statement name="getUserId" result-class="java.lang.Long">
    <![CDATA[
      SELECT max(id) from app_user;
    ]]>
    </mapped-statement>
    
	<mapped-statement name="addUserRole">
    <![CDATA[
      INSERT INTO 
      user_role (id, user_id, username, role_name)
      VALUES (#id#, #userId#, #username#, #roleName#);
    ]]>
    </mapped-statement>
    
	<mapped-statement name="getRoleId" result-class="java.lang.Long">
    <![CDATA[
      SELECT max(id) from user_role;
    ]]>
    </mapped-statement>
    
	<mapped-statement name="updateUser" result-class="org.appfuse.model.User">
    <![CDATA[
      UPDATE app_user SET
          username = #username#,
          password = #password#,
          firstName = #firstName#,
          lastName = #lastName#,
          address = #address#,
          city = #city#,
          country = #country#,
          email = #email#,
          phoneNumber = #phoneNumber#,
          postalCode = #postalCode#,
          province = #province#,
          website = #website#,
          passwordHint = #passwordHint#
      WHERE id = #id#;
    ]]>
    </mapped-statement>
    
	<mapped-statement name="getUser" result-class="org.appfuse.model.User">
    <![CDATA[
      SELECT * FROM app_user WHERE username=#username#;
    ]]>
    </mapped-statement>
    
	<mapped-statement name="getUsers" result-class="org.appfuse.model.User">
    <![CDATA[
      SELECT * FROM app_user ORDER BY UPPER(username);
    ]]>
    </mapped-statement>
    
	<mapped-statement name="getUserRoles" result-class="org.appfuse.model.UserRole">
    <![CDATA[
      SELECT id, role_name as roleName, user_id as userId, username
      FROM user_role WHERE username=#username#;
    ]]>
    </mapped-statement>
    
	<mapped-statement name="deleteUser">
    <![CDATA[
      DELETE FROM app_user where username = #username#;
    ]]>
    </mapped-statement>
    
	<mapped-statement name="deleteUserRoles">
    <![CDATA[
      DELETE FROM user_role WHERE username = #username#;
    ]]>
    </mapped-statement>
    
	<mapped-statement name="getUserCookies" result-class="org.appfuse.model.UserCookie">
    <![CDATA[
      SELECT id, username, cookie_id as cookieId, date_created as dateCreated
      FROM user_cookie where cookie_id = #cookieId#;
    ]]>
    </mapped-statement>
    
	<mapped-statement name="deleteUserCookies">
    <![CDATA[
      DELETE FROM user_cookie where username = #username#;
    ]]>
    </mapped-statement>
    
	<mapped-statement name="addUserCookie">
    <![CDATA[
      INSERT INTO 
      user_cookie (id, username, cookie_id, date_created)
      VALUES (#id#, #username#, #cookieId#, #dateCreated#);
    ]]>
    </mapped-statement>
    
	<mapped-statement name="getUserCookieId" result-class="java.lang.Long">
    <![CDATA[
      SELECT max(id) FROM user_cookie;
    ]]>
    </mapped-statement>
    
	<mapped-statement name="updateUserCookie" result-class="org.appfuse.model.UserCookie">
    <![CDATA[
      UPDATE user_cookie SET
          username = #username#,
          cookie_id = #cookieId#,
          date_created = #dateCreated#
      WHERE id = #id#;
    ]]>
    </mapped-statement>
</sql-map>
