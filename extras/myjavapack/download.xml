<?xml version="1.0"?>
<project name="myjavapack-installer" default="build" basedir=".">
    
    <property file="../../build.properties"/>
    
    <target name="install-myjavapack" description="downloads and expands myjavapack to current directory" unless="download">
        <get src="http://easynews.dl.sourceforge.net/sourceforge/myjavapack/myjavapack-installer-kit.zip" 
            dest="myjavapack-installer-kit.zip" verbose="true" usetimestamp="true"/>
        <unzip src="myjavapack-installer-kit.zip" dest="work"/>
    </target>
    
    <target name="build" description="builds installer" depends="install-myjavapack,clean">
        <mkdir dir="dist"/>
        <copy todir="${basedir}">
            <fileset dir="work/myjavapack-installer-kit" includes="**"/>
        </copy>
        
        <java jar="lib/compiler.jar" fork="true">
            <arg value="install.xml"/>
            <arg value="-b"/>
            <arg value="."/>
            <arg value="-k"/>
            <arg value="standard"/>
            <arg value="-o"/>
            <arg value="dist/${webapp.name}-installer.jar"/>
        </java>
        
        <copy tofile="dist/README.txt" file="README-dist.txt"/>
        <zip destfile="dist/${webapp.name}-installer-${webapp.version}.zip">
            <zipfileset prefix="${webapp.name}-installer-${webapp.version}" dir="dist">
                <exclude name="software.jar"/>
            </zipfileset>
        </zip>
    </target>
    
    <target name="clean" description="deletes generated files">
        <delete dir="dist"/>
    </target>
    
    <target name="cleanup" depends="clean" description="deletes myjavapack download and install">
        <delete dir="bin"/>
        <delete dir="docs"/>
        <delete dir="javadoc"/>
        <delete dir="lib"/>
        <delete dir="work"/>
        <delete>
            <fileset dir="." includes="*.sh"/>
            <fileset dir="." includes="*.html"/>
            <fileset dir="." includes="*.gif"/>
            <fileset dir="." includes="*.zip"/>
            <fileset dir="." includes="useNativeLAF"/>
        </delete>
        <echo/>
        <echo>You'll need to delete the JARs in this directory manually.</echo>
    </target>
</project>

